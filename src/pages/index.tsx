import styles from '@/styles/Home.module.css';
import Head from 'next/head';
import Link from 'next/link';
// css
import { useEffect } from 'react';
import Cookies from 'js-cookie';
import { useUserStore } from '@/store/user';
import { createClient } from '@/utils/server';

export default function Home() {
  const { accessToken, username, saveUser, removeUser } = useUserStore();
  const supabase = createClient();

  useEffect(() => {
    const params = new URLSearchParams(window?.location.hash.substring(1));
    const googleToken = params.get('access_token');
    const googleRefreshToken = params.get('refresh_token');

    const getUser = async () => {
      const user = await supabase.auth.getUser();
      saveUser(googleToken, user.data.user?.email);
    };

    if (googleToken) {
      getUser();
      Cookies.set('access_token', googleToken, { expires: 0.05 });
      Cookies.set('refresh_token', googleRefreshToken, { expires: 14 });
      // router.push('/');
    } else {
      console.log('로그인 재시도하세요.');
    }
  }, []);

  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        <div>{username}</div>
        <div>{username ? '회원' : '비회원'}</div>
        <button>
          <Link href="/login">로그인</Link>
        </button>
        <button>
          <Link href="/signUp">회원가입</Link>
        </button>
        <button>
          <Link href="/findPassword">비밀번호찾기</Link>
        </button>
      </main>
    </>
  );
}
